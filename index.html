
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>妈妈今天运动了吗</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="calc.css" rel="stylesheet" type="text/css">
    </head>
    <body>
        <h1>各式早餐</h1>
        <p>结账在页面的下方</p>
        <p id='prec'>保留小数点后几位？<input type="number" min=0 oninput="update_prec()" placeholder="默认2位"></p>
        <div style="overflow-x:auto;">
            <table id='atable'>
                <tr>
                    <th> 项目 </th>
                    <th> 系数 </th>
                    <th> 数量 </th>
                    <th> 乘积 </th>
                </tr>
                <tr>
                    <th> 动态心电图 </th>
                    <td id='mult'><input type="number" step="0.01" min=0 max=3 style="width:100%;height:100%" value=0.13></td>
                    <td id='inpu'><input type="number" min=0 style="width:100%;height:100%" value=0></td>
                    <td id='outp'>  </td>
                </tr>
                <tr>
                    <th> 脑电图 </th>
                    <td id='mult'><input type="number" step="0.01" min=0 style="width:100%;height:100%" value=0.13></td>
                    <td id='inpu'><input type="number" min=0 style="width:100%;height:100%" value=0></td>
                    <td id='outp'>  </td>
                </tr>
                <tr>
                    <th> 动态血压 </th>
                    <td id='mult'><input type="number" step="0.01" min=0 style="width:100%;height:100%" value=0.12></td>
                    <td id='inpu'><input type="number" min=0 style="width:100%;height:100%" value=0></td>
                    <td id='outp'>  </td>
                </tr>
                <tr>
                    <th> 运动平板 </th>
                    <td id='mult'><input type="number" step="0.01" min=0 style="width:100%;height:100%" value=0.12></td>
                    <td id='inpu'><input type="number" min=0 style="width:100%;height:100%" value=0></td>
                    <td id='outp'>  </td>
                </tr>
                <tr>
                    <th> 频谱心电图 </th>
                    <td id='mult'><input type="number" step="0.01" min=0 style="width:100%;height:100%" value=0.11></td>
                    <td id='inpu'><input type="number" min=0 style="width:100%;height:100%" value=0></td>
                    <td id='outp'>  </td>
                </tr>
                <tr>
                    <th> 常规心电图 </th>
                    <td id='mult'><input type="number" step="0.01" min=0 style="width:100%;height:100%" value=0.10></td>
                    <td id='inpu'><input type="number" min=0 style="width:100%;height:100%" value=0></td>
                    <td id='outp'>  </td>
                </tr>
                <tr>
                    <th> 总和 </th>
                    <td></td>
                    <td></td>
                    <td id='total'> </td>
                </tr>
            </table>
            <button type="button" onclick="myfun()" style="margin:15px">妈妈找我算账啦</button>
        </div>


    </body>
    <script>
        const MULT_COL = 1;
        const INPU_COL = 2;
        const OUTP_COL = 3;
        var prec = 2;
        function update_prec() {
            prec = document.getElementById('prec').getElementsByTagName('input')[0].value;
        }
        function get_table_input(row, col, table) {
            return table.rows[row].cells[col].getElementsByTagName('input')[0].value;
        }
        function set_table_cell(row, col, table, value) {
            return table.rows[row].cells[col].innerHTML = value;
        }
        function myfun() {
            var atable = document.getElementById('atable');
            var products = [];

            for(var i = 1; i < atable.rows.length -1; i++) {
                var prod = parseFloat(get_table_input(i, MULT_COL, atable)*get_table_input(i, INPU_COL, atable)).toFixed(prec);
                set_table_cell(i, OUTP_COL, atable, prod);
                products.push(prod);
            }
            
            total_sum = products.reduce((next, now) => parseFloat(next) + parseFloat(now));
            document.getElementById('total').innerHTML = parseFloat(total_sum).toFixed(prec);
        }
    </script>
</html>
